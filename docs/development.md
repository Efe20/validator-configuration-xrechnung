# Development of Validator Configuration XRechnung

## The build environment

We recommend `ant` version 1.10.x or newer (but should work with > 1.8.x).

The main `ant` targets for developing are:

* `compile` (here it is assembling all resources for validation)
* `test`
* and `dist` (creating the distribution artefact)

However, because of the complex dependencies, you may only expect `compile` target to work without any customizations.

### Test dependencies on the fly

If you build own local custom versions of dependencies such as XRechnung Schematron you can customize the ant build at runtime:

The following example demonstrates how to use a different CEN schematron release:

```shell
ant
-Dcen.rules.version=1.3.0
```

### Development properties file

In order to configure more complex adaption to the local development needs, you have to load a set of different properties from a file.

We provide the `development.build.properties.example` file for the most common properties to be set different than default. It contains some documentation.

You have to copy the file to e.g. `development.build.properties` and you have to explicitly provide the property file location at CLI for your development (otherwise tests will always fail or not executed at all).

```shell
ant -propertyfile ${your.own.property.file.name}
```

### Dependencies overview

#### Compile time

* UBL Schema
* CII Schema
* CEN Schema
* Saxon HE

#### Testing

* KoSIT XML Validator
* XML Mutate
* XRechnung Testsuite

## Test Approach

### Configuration Report Tests

All test instances in `src/test/instances` are designed to trigger certain kinds of report outputs. This is to test the report output on a technical level.

These reports are then tested using `src/test/assertions.xml`.

### XRechnung Testsuite

This test phase runs the KoSIT validator against all XRechnung Testsuite instances and expects all instances to be valid.

### CEN Unit Tests

The correctness of the whole validation process depends mostly on Schematron rules as implemented by CEN.
Hence, we started to also test aspects of those rules.

Currently, test instances are in `src/test/cen-unit-test` and tested using `XML Mutate`. We use positive and negative tests to verify the expected behavior of the CEN rules.

File names follow this convention:

`${cii,ubl}-${schematron-rule-id}-${description}.xml`

If more than one rule is tested than omit `${schematron-rule-id}`.

### XRechnung Integration Tests

Finally, the generated test instances -- which are generated by XML-Mutate from the previous CEN Unit Tests build step -- are run with the fully configured Validator Configuration.

This allows to also test the correct behavior of the whole integrated validation procedure in case of wrong input also including effects of changing severity of validation rules on the calculation of the final assessment (recommendation).

The integration test are coded in `src/test/assertions-integration-tests.xml`

## Distribution

The `ant` target `dist` creates the distribution zip archive for releases including several targets for testing.

If you want to skip tests call `ant dist-only`.
